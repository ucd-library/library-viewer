!function(t){"use strict";function o(t,o){this.config=null,this.container=null,this.controls={},this.aspect=null,this.renderer=null,this.scene=null,this.sceneId=null,this.sceneIdArray=[],this.sceneIdThumbsArray=[],this.sceneThumbIndex=0,this.camera=null,this.hotSpots=[],this.hotSpotTimerId=null,this.hotSpotTimerDelay=1e3,this.zindex=4,this.popover=!1,this.popoverTemplate=null,this.popoverCloseManual=!1,this.autoRotate={enabled:!1,speed:0},this.yaw={value:0,valuePrev:0,valueNext:0,valueInit:0,time:0,duration:0},this.pitch={value:0,valuePrev:0,valueNext:0,valueInit:0,time:0,duration:0},this.zoom={value:75,valuePrev:0,valueNext:0,valueInit:0,time:0,duration:0,min:40,max:100},this.grabControl={enabled:!1,x:0,y:0,pitchSaved:0,yawSaved:0},this.pinchZoom={zoom:0,startDate:!1,aStartX:0,aStartY:0,aCurX:0,aCurY:0,aIsMoving:!1,bStartX:0,bStartY:0,bCurX:0,bCurY:0,bIsMoving:!1},this.sceneThumbsControl={x:0,y:0,top:0,left:0,topSaved:0,leftSaved:0},this.hoverGrabControl={enabled:!1,pitchSaved:0,yawSaved:0},this.hotSpotSetupControl={enabled:!1,x:0,y:0,pitchSaved:0,yawSaved:0},this.animating=!1,this.loading=!1,this.xhr=null,this.timePrev=null,this.timeNext=null,this.timeInteraction=Date.now(),this.id=i++,this.init(t,o)}window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};var e=function(){function t(){}return t.prototype.css2json=function(t){var o={};if(!t)return o;if(t instanceof CSSStyleDeclaration)for(var e in t)t[e].toLowerCase&&(o[t[e].toLowerCase()]=t[t[e]]);else if("string"==typeof t){t=t.split(";");for(var e in t){var i=t[e].split(":");2==i.length&&(o[i[0].toLowerCase().trim()]=i[1].trim())}}return o},t.prototype.webgl=function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}},t.prototype.isiOS=function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},t.prototype.isMobile=function(t){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)},t.prototype.isTransition=function(){for(var t=["transition","MozTransition","WebkitTransition","OTransition","msTransition","KhtmlTransition"],o=document.documentElement,e=0;e<t.length;e++)if(t[e]in o.style)return!0;return!1},t.prototype.animationEvent=function(){var t=document.createElement("fakeelement"),o={animation:"animationend",MSAnimationEnd:"msAnimationEnd",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var e in o)if(void 0!==t.style[e])return o[e]},t}(),i=0;o.prototype={VERSION:"1.3.0",defaults:{theme:"ipnrm-theme-default",containerSizeSelector:null,imagePreview:null,autoLoad:!1,autoRotate:!1,autoRotateSpeed:.001,autoRotateInactivityDelay:3e3,mouseWheelPreventDefault:!0,mouseWheelDefaultRotate:!1,mouseWheelRotate:!1,mouseWheelRotateCoef:.2,mouseWheelZoom:!0,mouseWheelZoomCoef:.05,hoverGrab:!1,hoverGrabYawCoef:20,hoverGrabPitchCoef:20,grab:!0,grabCoef:.1,showControlsOnHover:!1,showSceneThumbsCtrl:!1,showSceneMenuCtrl:!1,showSceneNextPrevCtrl:!0,showShareCtrl:!1,showZoomCtrl:!0,showFullscreenCtrl:!0,showAutoRotateCtrl:!1,sceneThumbsVertical:!0,sceneThumbsStatic:!1,title:!0,compass:!0,keyboardNav:!0,keyboardZoom:!0,pinchZoom:!0,pinchZoomCoef:.1,pinchZoomPreventDefault:!0,sceneNextPrevLoop:!1,popover:!0,popoverTemplate:"<div class='ipnrm-popover'><div class='ipnrm-close'></div><div class='ipnrm-arrow'></div><div class='ipnrm-content'></div></div>",popoverPlacement:"top",popoverShowTrigger:"hover",popoverHideTrigger:"leave",popoverShowClass:null,popoverHideClass:null,hotSpotBelowPopover:!0,sceneId:null,sceneFadeDuration:3e3,sceneBackgroundLoad:!1,scenes:{defaults:{type:"cube",cubeTextureCount:"six",sphereWidthSegments:100,sphereHeightSegments:40,image:null,thumb:!1,thumbImage:null,yaw:0,pitch:0,zoom:75,title:null,titleSelector:null,titleHtml:!1,compassNorthOffset:null,hotSpots:[],saveCamera:!0,pitchLimits:!1,pitchLimitUp:30,pitchLimitDown:30,yawLimits:!1,yawLimitLeft:30,yawLimitRight:30}},mobile:!1,hotSpotSetup:!1,onHotSpotSetup:null,onCameraUpdate:null,onSceneChange:null,onShare:null,onLoad:null},cameraNearClipPlane:.1,cameraFarClipPlane:1e3,init:function(t,o){this.container=t,this.config=o,this.initScenes(),this.loadSceneImages(),this.initAutoRotate(),this.create()},initScenes:function(){for(var e in this.config.scenes)if(this.config.scenes.hasOwnProperty(e)){var i=t.extend({},o.prototype.defaults.scenes.defaults,this.config.scenes[e]);i._texturePreload=null,i._texture=null,i._yawInit=i.yaw,i._pitchInit=i.pitch,i._zoomInit=i.zoom,this.config.scenes[e]=i,this.sceneIdArray.push(e),i.thumb&&this.sceneIdThumbsArray.push(e)}},getImagePortion:function(t,o,e,i,n,s){var a=document.createElement("canvas"),r=a.getContext("2d");a.width=o,a.height=e;var h=document.createElement("canvas"),c=h.getContext("2d");return h.width=t.width,h.height=t.height,c.drawImage(t,0,0),r.drawImage(h,i,n,o*s,e*s,0,0,o,e),a},createCubeTextures:function(t){var o=t.width/6,e=t.height;return{front:this.getImagePortion(t,o,e,0*o,0,1),right:this.getImagePortion(t,o,e,1*o,0,1),back:this.getImagePortion(t,o,e,2*o,0,1),left:this.getImagePortion(t,o,e,3*o,0,1),top:this.getImagePortion(t,o,e,4*o,0,1),bottom:this.getImagePortion(t,o,e,5*o,0,1)}},loadSceneImages:function(){if(this.config.sceneBackgroundLoad){var t=[];for(var o in this.config.scenes)if(this.config.scenes.hasOwnProperty(o)){var e=this.config.scenes[o];"string"==typeof e.image?t.push({scene:e,imageType:"image",imageUrl:e.image}):e.image.hasOwnProperty("left")&&e.image.hasOwnProperty("right")&&e.image.hasOwnProperty("top")&&e.image.hasOwnProperty("bottom")&&e.image.hasOwnProperty("front")&&e.image.hasOwnProperty("back")&&(e._texturePreload={right:null,left:null,top:null,bottom:null,front:null,back:null},t.push({scene:e,imageType:"right",imageUrl:e.image.right}),t.push({scene:e,imageType:"left",imageUrl:e.image.left}),t.push({scene:e,imageType:"top",imageUrl:e.image.top}),t.push({scene:e,imageType:"bottom",imageUrl:e.image.bottom}),t.push({scene:e,imageType:"front",imageUrl:e.image.front}),t.push({scene:e,imageType:"back",imageUrl:e.image.back}))}var i={scenes:t,index:0,callback:this.preloadScenesImages};this.preloadScenesImages(i)}},preloadScenesImages:function(o){if(!(o.scenes.length<=o.index)){var e=new Image;e.onload=t.proxy(function(t){var i=o.scenes[o.index];"image"==i.imageType?"cube"==i.type?i.scene._texture=this.createCubeTextures(e):i.scene._texture={image:e}:(i.scene._texturePreload[i.imageType]=e,i.scene._texturePreload.right&&i.scene._texturePreload.left&&i.scene._texturePreload.top&&i.scene._texturePreload.bottom&&i.scene._texturePreload.front&&i.scene._texturePreload.back&&(i.scene._texture=i.scene._texturePreload,i.scene._texturePreload=null)),o.index++,o.callback.call(this,o)},this),e.onerror=t.proxy(function(t){o.index++,o.callback.call(this,o)},this),e.src=o.scenes[o.index].imageUrl}},initAutoRotate:function(){this.config.autoRotate?this.autoRotate.enabled=!0:this.autoRotate.enabled=!1,this.autoRotate.speed=this.config.autoRotateSpeed,this.timeInteraction=Date.now()-this.config.autoRotateInactivityDelay},create:function(){this.checkControls(),this.checkAnimation(),this.buildDOM(),this.resetHandlers(),this.util().webgl()?(this.applyHandlers(),this.resetHotSpots(),this.applyPopover(),this.applyHotSpots(),"function"==typeof this.config.onLoad&&this.config.onLoad.call(this),this.config.autoLoad&&(this.controls.$loadBtn.hide(),this.loadScene(this.config.sceneId))):(this.controls.$loadBtn.hide(),this.hideLoadInfo(),this.controls.$info.html("<p>Your browser does not support WebGL</p>"),this.controls.$info.fadeIn())},checkControls:function(){this.sceneIdArray.length>1||(this.config.showSceneNextPrevCtrl=!1)},checkAnimation:function(){var t=!this.config.mobile&&this.util().isMobile(navigator.userAgent);(void 0==this.util().animationEvent()||t)&&(this.config.popoverShowClass=null,this.config.popoverHideClass=null)},loadScene:function(o){function e(t,o){this.hideLoadInfo(),this.applyControls(t),this.loading=!1,this.resetTransition();var e=this.sceneId,i=t;this.buildScene(t,o),"function"==typeof this.config.onSceneChange&&this.config.onSceneChange.call(this,e,i),this.animateStart()}if(o){if(!this.config.scenes.hasOwnProperty(o))return this.showMessage("<p>Cannot load '"+o+"' scene</p>"),void console.error("Cannot load '"+o+"' scene");if(this.loading&&this.xhr&&4!=this.xhr.readyState&&this.xhr.abort(),this.loading=!0,this.showLoadInfo(),this.controlHotSpots(),this.sceneId&&this.config.scenes[this.sceneId].saveCamera){(i=this.config.scenes[this.sceneId]).pitch=this.pitch.value,i.yaw=this.yaw.value,i.zoom=this.zoom.value}var i=this.config.scenes[o];this.pitch.value=i.pitch,this.yaw.value=i.yaw,this.zoom.value=Math.max(this.zoom.min,Math.min(this.zoom.max,i.zoom)),this.pitch.valueInit=i._pitchInit,this.yaw.valueInit=i._yawInit,this.zoom.valueInit=Math.max(this.zoom.min,Math.min(this.zoom.max,i._zoomInit));var n={},s=0,a=0,r={};if(i._texture)e.call(this,o,i._texture);else{"string"==typeof i.image?n.image=i.image:i.image.hasOwnProperty("left")&&i.image.hasOwnProperty("right")&&i.image.hasOwnProperty("top")&&i.image.hasOwnProperty("bottom")&&i.image.hasOwnProperty("front")&&i.image.hasOwnProperty("back")?(n.right=i.image.right,n.left=i.image.left,n.top=i.image.top,n.bottom=i.image.bottom,n.front=i.image.front,n.back=i.image.back):(this.controls.$loadInfo.fadeTo("slow",0),this.showMessage("<p>Wrong parameter value for texture</p>"),console.error("Wrong parameter value for texture"));for(var h in n)n.hasOwnProperty(h)&&s++;for(var h in n)if(n.hasOwnProperty(h)){this.xhr=new XMLHttpRequest;var c=this.xhr;c.open("GET",n[h],!0),c.crossOrigin="Anonymous",c.responseType="arraybuffer",c.customKey=h,c.onprogress=t.proxy(function(t){var o=t.currentTarget;if(t.lengthComputable){r[o.customKey]={total:t.total,loaded:t.loaded};var e,i;for(var n in r)r.hasOwnProperty(n)&&(e=r[n].total,i=r[n].loaded);var s=Math.floor(i/e*100)+"%";this.controls.$loadProgressBar.stop().animate({width:s})}},this),c.onload=t.proxy(function(i){var r=i.currentTarget;if(r.status>=400)return r.onerror(i);var h=new Blob([r.response]),c=new Image;c.onload=t.proxy(function(t){if(n[t.customKey]=c,++a==s){var i=this.config.scenes[o];"cube"==i.type&&1==s&&(n=this.createCubeTextures(c)),i._texture=n,e.call(this,o,n)}},this,r),c.onerror=t.proxy(function(t){++a==s&&(this.hideLoadInfo(),this.showMessage("<p>Cannot load texture</p>"),console.error("Cannot load texture '"+n[t.customKey]+"'"))},this,r),c.src=window.URL.createObjectURL(h)},this),c.onerror=t.proxy(function(t){var o=t.currentTarget;this.hideLoadInfo(),this.showMessage("<p>Cannot load texture</p>"),console.error("Cannot load texture '"+n[o.customKey]+"'")},this),c.send()}}}},loadHotSpots:function(t,o){if(this.config.scenes.hasOwnProperty(t)){this.config.scenes[t].hotSpots=o,this.resetHotSpots(),this.applyHotSpots(),this.loading||this.controlHotSpots()}else console.error("Cannot load hotspots for the '"+t+"' scene")},applyHotSpots:function(){for(var o in this.config.scenes)if(this.config.scenes.hasOwnProperty(o)){for(var e=this.config.scenes[o],i=JSON.parse(JSON.stringify(e.hotSpots)),n=0,s=i.length;n<s;n++){var a=i[n];if(a.yaw=a.yaw?a.yaw:0,a.pitch=a.pitch?a.pitch:0,a.sceneOwnerId=o,a.xyz=this.getPitchYawPoint(a.pitch,a.yaw),a.visible=!1,a.className?a.$el=t("<div class='ipnrm-hotspot-custom "+a.className+"' style='display:none;'></div>"):a.imageUrl?a.$el=t("<div class='ipnrm-hotspot-custom' style='display:none;'></div>"):a.$el=t("<div class='ipnrm-hotspot' style='display:none;'></div>"),a.imageUrl){var r="style='";(a.imageWidth||a.imageHeight)&&(r=r+(a.imageWidth?"width:"+a.imageWidth+"px;":"")+(a.imageHeight?"height:"+a.imageHeight+"px;":"")),r+="'";var h=t("<div class='ipnrm-hotspot-image'></div>");a.$image=t("<img src='"+a.imageUrl+"' alt=''"+r+">"),a.$el.append(h.append(a.$image))}if(a.link){h=t("<div class='ipnrm-hotspot-link'></div>").append("<a href='"+a.link+"' target='"+(a.linkNewWindow?"_blank":"_self")+"' rel='nofollow'>");a.$el.append(h)}if(a.content){h=t("<div class='ipnrm-hotspot-data'></div>").append(a.content);a.$el.append(h)}if("boolean"!=typeof a.popoverLazyload&&(a.popoverLazyload=!0),"boolean"!=typeof a.popoverShow&&(a.popoverShow=!1),a.$popover=null,"string"==typeof a.sceneId&&(a.$el.addClass("ipnrm-hotspot-scene"),a.$el.on("click.ipanorama touchstart.ipanorama",t.proxy(this.onHotSpotSceneClick,this,a))),"function"==typeof e.hotSpots[n].popoverContent&&(a.popoverContent=e.hotSpots[n].popoverContent),a.$el.on("touchend.ipanorama",t.proxy(this.onHotSpotTouchEnd,this,a)),a.popoverContent||a.popoverSelector){for(var c=(l=this.config.popoverShowTrigger.split(" ")).length;c--;){"click"==(p=l[c])?(a.$el.on("click.ipanorama",t.proxy(this.onHotSpotClick,this,a)),a.$el.on("touchstart.ipanorama",t.proxy(this.onHotSpotClick,this,a))):"hover"==p&&(a.$el.on("mouseenter.ipanorama",t.proxy(this.onHotSpotEnter,this,a)),a.$el.on("touchstart.ipanorama",t.proxy(this.onHotSpotClick,this,a)))}var l;for(c=(l=this.config.popoverHideTrigger.split(" ")).length;c--;){var p;"click"==(p=l[c])?(a.$el.on("click.ipanorama",t.proxy(this.onPopoverHide,this,a)),a.$el.on("touchstart.ipanorama",t.proxy(this.onPopoverHide,this,a))):"grab"==p?t("body").add(this.controls.$view).on("mousedown.ipanorama touchstart.ipanorama",t.proxy(this.onPopoverHide,this,a)):"leave"==p?(a.$el.on("mouseleave.ipanorama",t.proxy(this.onHotSpotLeave,this,a)),t("body").add(this.controls.$view).on("touchstart.ipanorama",t.proxy(this.onPopoverHide,this,a))):"manual"==p&&(this.popoverCloseManual=!0)}}this.controls.$hotspots.append(a.$el),!this.popover||a.popoverLazyload&&!a.popoverShow||(this.createPopover(a),a.popoverShow&&a.$popover.addClass("ipnrm-active"))}this.hotSpots=this.hotSpots.concat(i)}},resetHotSpots:function(){this.controls.$hotspots.children().fadeTo("slow",0,function(){t(this).remove()})},applyPopover:function(){if(this.popover=this.config.popover,this.popover){if(1!=t(this.config.popoverTemplate).length)return this.popover=!1,void console.error("'popoverTemplate' option must consist of exactly 1 top-level element!");this.popoverTemplate=this.config.popoverTemplate}},createPopover:function(o){if(!o.$popover){o.$popover=t(this.popoverTemplate);var e=this.getPopoverUID("popover");o.$popover.attr("id",e),this.popoverCloseManual&&(o.$popover.addClass("ipnrm-close"),o.$popover.find(".ipnrm-close").on("click.ipanorama",t.proxy(this.onPopoverHide,this,o))),o.$popover.on("click.ipanorama",t.proxy(this.onPopoverClick,this,o))}var i=o.$popover;if(!i.hasClass("ipnrm-active")||o.$popover.hasClass(this.config.popoverHideClass)){var n=this.getPopoverContent(o);i.find(".ipnrm-content").children().detach().end()[o.popoverHtml?"string"==typeof n?"html":"append":"text"](n),i.detach().css({top:-9999,left:-9999,width:""}),i.removeClass(this.config.popoverHideClass),i.removeClass(this.config.popoverShowClass),o.popoverWidth&&i.css({"max-width":o.popoverWidth,"min-width":o.popoverWidth}),this.liftupPopover(o),i.appendTo(this.controls.$panorama),i[0].offsetWidth>0&&i.css({width:i[0].offsetWidth}),this.resetHotSpotTimer(),this.hotSpotTimerDelay=600,this.hotSpotTimerId=setTimeout(t.proxy(this.onHotSpotTimer,this),this.hotSpotTimerDelay)}},showPopover:function(o){if(this.popover&&o.visible&&(o.popoverContent||o.popoverSelector)){this.createPopover(o);var e=this.config.popoverPlacement;o.popoverPlacement&&(e=o.popoverPlacement);var i=this.getPopoverPosition(o),n=o.$popover,s=n[0].offsetWidth,a=n[0].offsetHeight,r=this.getPopoverOffset(e,i,s,a);this.applyPopoverPlacement(o,r,e),n.hasClass("ipnrm-active")||(n.removeClass(this.config.popoverHideClass),n.addClass(this.config.popoverShowClass),this.config.popoverShowClass?(o.$popover.css("visibility","visible"),o.$popover.addClass("ipnrm-active").addClass(this.config.popoverShowClass),o.$popover.one(this.util().animationEvent(),t.proxy(function(o){var e=t(o.target);e.hasClass(this.config.popoverHideClass)||e.removeClass(this.config.popoverShowClass),e.css("visibility","")},this))):n.addClass("ipnrm-active"))}},hidePopover:function(o){o.$popover&&(o.$popover.hasClass("ipnrm-active")||o.$popover.hasClass(this.config.popoverShowClass))&&(o.$popover.removeClass(this.config.popoverShowClass),o.$popover.css("z-index",""),o.$el.css("z-index",""),this.config.popoverHideClass?(o.$popover.addClass(this.config.popoverHideClass),o.$popover.one(this.util().animationEvent(),t.proxy(function(e){var i=t(e.target);i.hasClass(this.config.popoverShowClass)||(i.removeClass(this.config.popoverHideClass),this.retachPopover(o.$popover))},this))):this.retachPopover(o.$popover))},retachPopover:function(t){t.removeClass("ipnrm-active"),t.detach(),t.get(0).offsetHeight,t.css({top:-9999,left:-9999,width:""}),t.appendTo(this.controls.$view),0==this.controls.$panorama.find(".ipnrm-popover.ipnrm-active").length&&(this.controls.$panorama.find(".ipnrm-hotspot, .ipnrm-popover").css("z-index",""),this.zindex=4)},liftupPopover:function(t){(this.hotSpots.length>1||t.popoverShow)&&(this.config.hotSpotBelowPopover?(t.$el.css("z-index",this.zindex+1),t.$popover.css("z-index",this.zindex+2)):(t.$el.css("z-index",this.zindex+2),t.$popover.css("z-index",this.zindex+1)),this.zindex=this.zindex+2)},resetHotSpotTimer:function(){this.hotSpotTimerId&&clearTimeout(this.hotSpotTimerId)},onHotSpotTimer:function(){var o=!1;this.hotSpotTimerDelay+=200;for(var e=this.hotSpots.length;e--;){var i=this.hotSpots[e];i.$popover&&i.$popover.hasClass("ipnrm-active")&&!i.$popover.hasClass(this.config.popoverHideClass)&&(o=!0,i.$popover.hasClass(this.config.popoverShowClass)||this.showPopover(i))}this.hotSpotTimerDelay>1800&&(o=!1),this.hotSpotTimerId=o?setTimeout(t.proxy(this.onHotSpotTimer,this),this.hotSpotTimerDelay):null},getPopoverContent:function(o){if(o.popoverContent)return"function"==typeof o.popoverContent?o.popoverContent.call(o):o.popoverContent;if(o.popoverSelector){return t(o.popoverSelector).html()}return""},getPopoverPosition:function(o){var e=o.$el,i=e.get(0).getBoundingClientRect(),n=e.offset(),s=t.extend({},i,n);return s.top=s.top+s.height/2,s.left=s.left+s.width/2,s},getPopoverOffset:function(t,o,e,i){return"bottom"==t?{top:o.top,left:o.left-e/2}:"top"==t?{top:o.top-i,left:o.left-e/2}:"left"==t?{top:o.top-i/2,left:o.left-e}:"right"==t?{top:o.top-i/2,left:o.left}:"bottom-left"==t?{top:o.top,left:o.left-e}:"bottom-right"==t?{top:o.top,left:o.left}:"top-left"==t?{top:o.top-i,left:o.left-e}:"top-right"==t?{top:o.top-i,left:o.left}:{top:o.top-i,left:o.left-e/2}},applyPopoverPlacement:function(o,e,i){var n=o.$popover,s=(n[0].offsetWidth,n[0].offsetHeight,parseInt(n.css("margin-top"),10)),a=parseInt(n.css("margin-left"),10),r=parseInt(n.css("margin-bottom"),10),h=parseInt(n.css("margin-right"),10);isNaN(s)&&(s=0),isNaN(a)&&(a=0),isNaN(r)&&(r=0),isNaN(h)&&(h=0),e.top+=s-r,e.left+=a-h,t.offset.setOffset(n[0],t.extend({using:function(t){n.css({top:Math.round(t.top),left:Math.round(t.left)})}},e),0);for(var c=["top","left","bottom","right","top-left","top-right","bottom-left","bottom-right"],l=c.length;l--;)if(c[l]==i){c.splice(l,1);break}for(l=c.length;l--;)n.removeClass("ipnrm-popover-"+c[l]);n.addClass("ipnrm-popover-"+i)},getPopoverUID:function(t){do{t+=~~(1e6*Math.random())}while(document.getElementById(t));return t},buildDOM:function(){if(this.container.empty(),this.controls.$panorama=t("<div class='ipnrm"+(this.config.theme?" "+this.config.theme:"")+(this.config.showControlsOnHover?" ipnrm-hide-controls":"")+"' tabindex='1'></div>"),this.controls.$view=t("<div class='ipnrm-view'></div>"),this.controls.$preview=t("<div class='ipnrm-preview'></div>"),this.config.imagePreview&&this.controls.$preview.css("background-image","url("+this.config.imagePreview+")"),this.controls.$scene=t("<div class='ipnrm-scene'></div>"),this.controls.$hotspots=t("<div class='ipnrm-hotspots'></div>"),this.setViewCursorShape("ipnrm-grab"),this.controls.$view.append(this.controls.$preview),this.controls.$view.append(this.controls.$scene),this.controls.$view.append(this.controls.$hotspots),this.controls.$loadBtn=t("<div class='ipnrm-btn-load'><p>click to<br>load<br>panorama</p></div>"),this.controls.$loadInfo=t("<div class='ipnrm-load-info' style='display:none'></div>"),this.controls.$loadInfoInner=t("<div class='ipnrm-load-info-inner'><p>Loading</p></div>"),this.controls.$loadProgress=t("<div class='ipnrm-load-progress'></div>"),this.controls.$loadProgressBar=t("<div class='ipnrm-load-progress-bar'></div>"),this.controls.$loadProgress.append(this.controls.$loadProgressBar),this.controls.$loadInfoInner.append(this.controls.$loadProgress),this.controls.$loadInfo.append(this.controls.$loadInfoInner),this.controls.$info=t("<div class='ipnrm-info' style='display:none'></div>"),this.controls.$controls=t("<div class='ipnrm-controls'></div>"),this.controls.$sceneThumbs=t("<div class='ipnrm-scene-thumbs'></div>"),this.controls.$sceneThumbsInner=t("<div class='ipnrm-scene-thumbs-inner'></div>"),this.controls.$toolbar=t("<div class='ipnrm-toolbar' style='display:none'></div>"),this.controls.$sceneMenu=t("<div class='ipnrm-btn-scene-menu ipnrm-btn' style='display:none'></div>"),this.controls.$scenePrev=t("<div class='ipnrm-btn-scene-prev ipnrm-btn' style='display:none'></div>"),this.controls.$sceneNext=t("<div class='ipnrm-btn-scene-next ipnrm-btn' style='display:none'></div>"),this.controls.$zoomIn=t("<div class='ipnrm-btn-zoom-in ipnrm-btn' style='display:none'></div>"),this.controls.$zoomOut=t("<div class='ipnrm-btn-zoom-out ipnrm-btn' style='display:none'></div>"),this.controls.$share=t("<div class='ipnrm-btn-share ipnrm-btn' style='display:none'></div>"),this.controls.$fullscreen=t("<div class='ipnrm-btn-fullscreen ipnrm-btn' style='display:none'></div>"),this.controls.$autorotate=t("<div class='ipnrm-btn-autorotate ipnrm-btn' style='display:none'></div>"),this.controls.$autorotate.addClass(this.config.autoRotate?"ipnrm-active":""),this.controls.$compass=t("<div class='ipnrm-compass' style='display:none'></div>"),this.controls.$title=t("<div class='ipnrm-title' style='display:none'></div>"),this.config.showSceneThumbsCtrl||this.config.showSceneMenuCtrl){for(var o in this.config.scenes)if(this.config.scenes.hasOwnProperty(o)){var e=this.config.scenes[o];if(e.thumb){var i=t("<div class='ipnrm-scene-thumb'></div>");i.attr("data-sceneid",o),e.thumbImage&&i.append("<img class='ipnrm-scene-thumb-img' src='"+e.thumbImage+"' alt=''>"),this.controls.$sceneThumbsInner.append(i)}}this.controls.$sceneThumbs.append(this.controls.$sceneThumbsInner)}this.controls.$controls.append(this.controls.$sceneThumbs,this.controls.$toolbar,this.controls.$sceneMenu,this.controls.$scenePrev,this.controls.$sceneNext,this.controls.$zoomIn,this.controls.$zoomOut,this.controls.$share,this.controls.$fullscreen,this.controls.$autorotate,this.controls.$compass,this.controls.$title),this.container.append(this.controls.$panorama),this.controls.$panorama.append(this.controls.$view,this.controls.$loadBtn,this.controls.$loadInfo,this.controls.$info,this.controls.$controls)},buildScene:function(o,e){var i=this.controls.$view.width(),n=this.controls.$view.height();if(0==i&&0==n){var s=t(this.config.containerSizeSelector);i=s.width(),n=s.height()}this.sceneId=o,this.aspect=i/n,this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(this.zoom.value,this.aspect,this.cameraNearClipPlane,this.cameraFarClipPlane),this.buildGeomentry(o,e),this.renderer=new THREE.WebGLRenderer({antialias:!1}),this.renderer.setClearColor(0,0),this.renderer.setSize(i,n),this.renderer.setPixelRatio(Math.floor(window.devicePixelRatio));var a=t(this.renderer.domElement);a.fadeTo(0,0),this.controls.$scene.append(a),a.fadeTo(this.config.sceneFadeDuration,1,t.proxy(function(){this.controls.$scene.children().length>1&&this.controls.$scene.children(":first-child").remove()},this))},buildGeomentry:function(t,o){var e=this.config.scenes[t];"cube"==e.type?this.buildCube(o):"sphere"==e.type?this.buildSphere(o,e):"cylinder"==e.type&&this.buildCylinder(o)},buildCube:function(t){var o=new THREE.BoxGeometry(100,100,100);o.scale(-1,1,1);var e=null;if(t.hasOwnProperty("image")){(e=new THREE.MeshBasicMaterial({side:THREE.FrontSide})).map=this.createTexture(t,"image");var i=[new THREE.Vector2(0,1),new THREE.Vector2(0,0),new THREE.Vector2(.166,0),new THREE.Vector2(.166,1)],n=[new THREE.Vector2(.166,1),new THREE.Vector2(.166,0),new THREE.Vector2(.333,0),new THREE.Vector2(.333,1)],s=[new THREE.Vector2(.333,1),new THREE.Vector2(.333,0),new THREE.Vector2(.5,0),new THREE.Vector2(.5,1)],a=[new THREE.Vector2(.5,1),new THREE.Vector2(.5,0),new THREE.Vector2(.666,0),new THREE.Vector2(.666,1)],r=[new THREE.Vector2(.833,1),new THREE.Vector2(.666,1),new THREE.Vector2(.666,0),new THREE.Vector2(.833,0)],h=[new THREE.Vector2(.833,0),new THREE.Vector2(1,0),new THREE.Vector2(1,1),new THREE.Vector2(.833,1)];o.faceVertexUvs[0]=[],o.faceVertexUvs[0][0]=[n[0],n[1],n[3]],o.faceVertexUvs[0][1]=[n[1],n[2],n[3]],o.faceVertexUvs[0][2]=[a[0],a[1],a[3]],o.faceVertexUvs[0][3]=[a[1],a[2],a[3]],o.faceVertexUvs[0][4]=[r[0],r[1],r[3]],o.faceVertexUvs[0][5]=[r[1],r[2],r[3]],o.faceVertexUvs[0][8]=[i[0],i[1],i[3]],o.faceVertexUvs[0][9]=[i[1],i[2],i[3]],o.faceVertexUvs[0][6]=[h[0],h[1],h[3]],o.faceVertexUvs[0][7]=[h[1],h[2],h[3]],o.faceVertexUvs[0][10]=[s[0],s[1],s[3]],o.faceVertexUvs[0][11]=[s[1],s[2],s[3]]}else{var c=[];c.push(new THREE.MeshBasicMaterial({map:this.createTexture(t,"right"),side:THREE.FrontSide})),c.push(new THREE.MeshBasicMaterial({map:this.createTexture(t,"left"),side:THREE.FrontSide})),c.push(new THREE.MeshBasicMaterial({map:this.createTexture(t,"top"),side:THREE.FrontSide})),c.push(new THREE.MeshBasicMaterial({map:this.createTexture(t,"bottom"),side:THREE.FrontSide})),c.push(new THREE.MeshBasicMaterial({map:this.createTexture(t,"front"),side:THREE.FrontSide})),c.push(new THREE.MeshBasicMaterial({map:this.createTexture(t,"back"),side:THREE.FrontSide})),e=new THREE.MeshFaceMaterial(c)}var l=new THREE.Mesh(o,e);this.scene.add(l)},buildSphere:function(t,o){var e=new THREE.SphereGeometry(100,o.sphereWidthSegments,o.sphereHeightSegments);e.scale(-1,1,1);var i=new THREE.MeshBasicMaterial({side:THREE.FrontSide});t.hasOwnProperty("image")&&(i.map=this.createTexture(t,"image"));var n=new THREE.Mesh(e,i);this.scene.add(n)},buildCylinder:function(t){var o=null,e=null;if(t.hasOwnProperty("image")){o=t.image.width/t.image.height;var i=2*Math.PI*100/o;e=new THREE.CylinderGeometry(100,100,i,40,1,!0)}else e=new THREE.CylinderGeometry(100,100,200,40,1,!0);e.scale(-1,1,1);var n=new THREE.MeshBasicMaterial({side:THREE.FrontSide});t.hasOwnProperty("image")&&(n.map=this.createTexture(t,"image"));var s=new THREE.Mesh(e,n);this.scene.add(s)},animateStart:function(){"undefined"!=typeof performance&&performance.now()?this.timePrev=performance.now():this.timePrev=Date.now(),this.animating||this.loading||(this.animating=!0,this.animate())},animate:function(){this.loading?this.animating=!1:(this.renderScene(),this.controlHotSpots(),this.controlCompass(),this.grabControl.enabled?(this.controlHoverGrabControl(),this.animationId=requestAnimationFrame(t.proxy(this.animate,this))):this.isTransition()||this.hoverGrabControl.enabled?(this.applyTransition(),this.controlHoverGrabControl(),this.animationId=requestAnimationFrame(t.proxy(this.animate,this))):this.animating=!1)},controlYawPitchLimits:function(){var t=this.config.scenes[this.sceneId];if(t.yawLimits){var o=this.yaw.valueInit-this.yaw.value;o<0&&Math.abs(o)>t.yawLimitLeft?this.yaw.value=this.yaw.valueInit+t.yawLimitLeft:o>0&&Math.abs(o)>t.yawLimitRight&&(this.yaw.value=this.yaw.valueInit-t.yawLimitRight)}if(t.pitchLimits){var e=this.pitch.valueInit-this.pitch.value;e>0&&Math.abs(e)>t.pitchLimitUp?this.pitch.value=this.pitch.valueInit-t.pitchLimitUp:e<0&&Math.abs(e)>t.pitchLimitDown&&(this.pitch.value=this.pitch.valueInit+t.pitchLimitDown)}},isTransition:function(){return!!(this.autoRotate.enabled||this.yaw.time<this.yaw.duration||this.pitch.time<this.pitch.duration||this.zoom.time<this.zoom.duration)},applyTransition:function(){"undefined"!=typeof performance&&performance.now()?this.timeNext=performance.now():this.timeNext=Date.now(),void 0===this.timePrev&&(this.timePrev=this.timeNext);var t=this.timeNext-this.timePrev,o=Date.now()-this.timeInteraction;this.autoRotate.enabled&&o>this.config.autoRotateInactivityDelay&&(this.yaw.value-=this.autoRotate.speed*t),this.applyInterpolation(this.yaw,t),this.applyInterpolation(this.pitch,t),this.applyInterpolation(this.zoom,t),this.controlYawPitchLimits(),this.zoom.value=Math.max(this.zoom.min,Math.min(this.zoom.max,this.zoom.value)),this.timePrev=this.timeNext},resetTransition:function(){this.yaw.time=this.yaw.duration,this.pitch.time=this.pitch.duration,this.zoom.time=this.zoom.duration},resetScene:function(){this.animationId&&cancelAnimationFrame(this.animationId),this.renderer=null,this.scene=null,this.camera=null,this.container.empty()},renderScene:function(){this.camera.fov!=this.zoom.value&&(this.camera.fov=this.zoom.value,this.camera.updateProjectionMatrix()),this.camera.lookAt(this.getPitchYawPoint(this.pitch.value,this.yaw.value));var t=this.renderer.getSize();this.renderer.clear(),this.renderer.setViewport(0,0,t.width,t.height),this.renderer.render(this.scene,this.camera),"function"==typeof this.config.onCameraUpdate&&this.config.onCameraUpdate.call(this,this.yaw.value,this.pitch.value,this.zoom.value)},controlCompass:function(){if(this.config.compass&&this.sceneId&&null!=this.config.scenes[this.sceneId].compassNorthOffset){var t=this.config.scenes[this.sceneId].compassNorthOffset-this.yaw.value;this.controls.$compass.css({transform:"rotate("+t+"deg)"})}},controlHotSpots:function(){if(null!=this.camera){var o=this.controls.$view.width(),e=this.controls.$view.height();if(0==o&&0==e){var i=t(this.config.containerSizeSelector);o=i.width(),e=i.height()}var n=new THREE.Frustum;n.setFromMatrix((new THREE.Matrix4).multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse));for(var s=this.hotSpots.length;s--;){var a=this.hotSpots[s];!this.loading&&n.containsPoint(a.xyz)&&a.sceneOwnerId==this.sceneId?a.visible?this.updateHotSpots(this.camera,o,e,a):(a.visible=!0,a.$el.fadeIn(),a.$popover&&a.$popover.removeClass("ipnrm-hidden"),this.updateHotSpots(this.camera,o,e,a)):a.visible&&(a.visible=!1,a.$el.fadeOut(),a.$popover&&a.$popover.addClass("ipnrm-hidden"),this.updateHotSpots(this.camera,o,e,a)),a.$popover&&a.$popover.hasClass("ipnrm-active")&&!a.$popover.hasClass(this.config.popoverHideClass)&&this.showPopover(a)}}},updateHotSpots:function(t,o,e,i){var n=this.getHotSpotScreenPos(i,t,o,e);i.$el.css({top:n.y-i.$el.height()/2,left:n.x-i.$el.width()/2})},getHotSpotScreenPos:function(t,o,e,i){var n=new THREE.Vector3(t.xyz.x,t.xyz.y,t.xyz.z);return n.project(o),n.x=(n.x+1)/2*e,n.y=-(n.y-1)/2*i,{x:n.x,y:n.y}},applyHandlers:function(){this.controls.$loadBtn.on("click.ipanorama",t.proxy(this.onLoadBtnClick,this)),this.controls.$sceneMenu.on("click.ipanorama",t.proxy(this.onSceneMenuClick,this)),this.controls.$scenePrev.on("click.ipanorama",t.proxy(this.onScenePrevClick,this)),this.controls.$sceneNext.on("click.ipanorama",t.proxy(this.onSceneNextClick,this)),this.controls.$zoomIn.on("click.ipanorama",t.proxy(this.onZoomIn,this)),this.controls.$zoomOut.on("click.ipanorama",t.proxy(this.onZoomOut,this)),this.controls.$share.on("click.ipanorama",t.proxy(this.onShare,this)),this.controls.$fullscreen.on("click.ipanorama",t.proxy(this.onFullScreen,this)),this.controls.$autorotate.on("click.ipanorama",t.proxy(this.onAutoRotate,this)),this.controls.$view.on("click.ipanorama",t.proxy(this.onMouseClick,this)),this.controls.$view.on("mousewheel.ipanorama DOMMouseScroll.ipanorama",t.proxy(this.onMouseWheel,this)),(this.config.showSceneThumbsCtrl||this.config.showSceneMenuCtrl)&&(this.controls.$sceneThumbs.find(".ipnrm-scene-thumb").on("click.ipanorama",t.proxy(this.onSceneThumbClick,this)),this.controls.$sceneThumbs.on("mousewheel.ipanorama DOMMouseScroll.ipanorama",t.proxy(this.onSceneThumbsWheel,this)),this.controls.$sceneThumbs.on("mousedown.ipanorama",t.proxy(this.onSceneThumbsGrabMouseDown,this)),this.controls.$sceneThumbs.on("touchstart.ipanorama",t.proxy(this.onSceneThumbsGrabTouchStart,this)),this.controls.$sceneThumbs.on("touchmove.ipanorama",t.proxy(this.onSceneThumbsGrabTouchMove,this)),this.controls.$sceneThumbs.on("touchend.ipanorama",t.proxy(this.onSceneThumbsGrabTouchEnd,this))),this.config.pinchZoom&&(this.controls.$view.on("touchstart.ipanorama-pinchzoom",t.proxy(this.onMultiTouchStart,this)),this.controls.$view.on("touchend.ipanorama-pinchzoom",t.proxy(this.onMultiTouchEnd,this))),this.config.grab&&(this.controls.$view.on("mousedown.ipanorama-grab",t.proxy(this.onGrabMouseDown,this)),this.controls.$view.on("touchstart.ipanorama-grab",t.proxy(this.onGrabTouchStart,this)),this.controls.$view.on("touchmove.ipanorama-grab",t.proxy(this.onGrabTouchMove,this)),this.controls.$view.on("touchend.ipanorama-grab",t.proxy(this.onGrabTouchEnd,this))),this.config.showControlsOnHover&&(this.controls.$panorama.one("mousemove.ipanorama",t.proxy(this.onPanoramaEnter,this)),this.controls.$panorama.on("mouseenter.ipanorama",t.proxy(this.onPanoramaEnter,this)),this.controls.$panorama.on("mouseleave.ipanorama",t.proxy(this.onPanoramaLeave,this))),this.config.hoverGrab&&(this.controls.$panorama.on("mouseenter.ipanorama",t.proxy(this.onHoverGrabEnter,this)),this.controls.$panorama.on("mouseleave.ipanorama",t.proxy(this.onHoverGrabLeave,this))),this.controls.$panorama.on("blur.ipanorama",t.proxy(this.onBlur,this)),this.controls.$panorama.on("keydown.ipanorama",t.proxy(this.onKeyDown,this)),this.controls.$panorama.on("keyup.ipanorama",t.proxy(this.onKeyUp,this)),this.controls.$panorama.on("fullscreenchange.ipanorama mozfullscreenchange.ipanorama webkitfullscreenchange.ipanorama msfullscreenchange.ipanorama",t.proxy(this.onFullScreenChange,this)),t(window).on("resize.ipanorama-"+this.id,t.proxy(this.onResize,this)),t(window).on("blur.ipanorama-"+this.id,t.proxy(this.onBlur,this)),t(document).on("visibilitychange.ipanorama-"+this.id,t.proxy(this.onVisibilityChange,this))},resetHandlers:function(){this.controls.$loadBtn.off("click.ipanorama"),this.controls.$sceneMenu.off("click.ipanorama"),this.controls.$scenePrev.off("click.ipanorama"),this.controls.$sceneNext.off("click.ipanorama"),this.controls.$zoomIn.off("click.ipanorama"),this.controls.$zoomOut.off("click.ipanorama"),this.controls.$share.off("click.ipanorama"),this.controls.$fullscreen.off("click.ipanorama"),this.controls.$view.off("click.ipanorama"),this.controls.$view.off("mousewheel.ipanorama DOMMouseScroll.ipanorama"),this.controls.$sceneThumbs.off("mousewheel.ipanorama DOMMouseScroll.ipanorama"),this.controls.$sceneThumbs.find(".ipnrm-scene-thumb").off("click.ipanorama"),this.config.grab&&(this.controls.$view.off("mousedown.ipanorama-grab"),this.controls.$view.off("touchstart.ipanorama-grab"),this.controls.$view.off("touchmove.ipanorama-grab"),this.controls.$view.off("touchend.ipanorama-grab")),this.config.pinchZoom&&(this.controls.$view.off("touchstart.ipanorama-pinchzoom"),this.controls.$view.off("touchmove.ipanorama-pinchzoom"),this.controls.$view.off("touchend.ipanorama-pinchzoom")),this.config.showControlsOnHover&&(this.controls.$panorama.off("mouseenter.ipanorama"),this.controls.$panorama.off("mouseleave.ipanorama")),this.controls.$panorama.off("blur.ipanorama"),this.controls.$panorama.off("keydown.ipanorama"),this.controls.$panorama.off("keyup.ipanorama"),this.controls.$panorama.off("fullscreenchange.ipanorama mozfullscreenchange.ipanorama webkitfullscreenchange.ipanorama msfullscreenchange.ipanorama"),t(window).off("mousemove.ipanorama-"+this.id),t(window).off("mouseup.ipanorama-"+this.id),t(window).off("resize.ipanorama-"+this.id),t(window).off("blur.ipanorama-"+this.id),t(document).off("visibilitychange.ipanorama-"+this.id)},onVisibilityChange:function(t){"visible"==document.visibilityState&&this.sceneId&&(this.refreshLayout(),this.loadScene(this.sceneId))},onHotSpotSceneClick:function(t,o){o.preventDefault(),o.stopPropagation(),this.loadScene(t.sceneId)},onHotSpotClick:function(t,o){t.$popover&&t.$popover.hasClass("ipnrm-active")||o.stopImmediatePropagation(),this.showPopover(t)},onHotSpotEnter:function(t,o){this.showPopover(t)},onHotSpotTouchStart:function(t,o){this.showPopover(t)},onHotSpotTouchEnd:function(o,e){t(e.target).is("a")&&(e.preventDefault(),e.target.click())},onHotSpotLeave:function(o,e){if(o.$popover){var i=e.toElement||e.relatedTarget;0!==o.$popover.has(i).length||o.$popover.is(i)||o.$el.is(i)?o.$popover.one("mouseleave.ipanorama",t.proxy(this.onHotSpotLeave,this,o)):this.hidePopover(o)}},onPopoverHide:function(o,e){o.$popover&&(0===o.$popover.has(e.target).length||t(e.target).hasClass("ipnrm-close"))&&(t(e.target).hasClass("ipnrm-close")&&e.stopImmediatePropagation(),this.hidePopover(o))},onPopoverClick:function(t,o){t.$popover&&this.liftupPopover(t)},onFullScreenChange:function(){this.util().isiOS()||(document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?(this.controls.$panorama.addClass("ipnrm-fullscreen"),this.controls.$fullscreen.addClass("ipnrm-active")):(this.controls.$panorama.removeClass("ipnrm-fullscreen"),this.controls.$fullscreen.removeClass("ipnrm-active")))},toggleFullScreen:function(){if(this.util().isiOS())this.controls.$panorama.hasClass("ipnrm-fullscreen")?(this.controls.$panorama.removeClass("ipnrm-fullscreen ipnrm-fullscreen-emulation"),this.controls.$panorama.get(0).offsetHeight,this.controls.$fullscreen.removeClass("ipnrm-active")):(this.controls.$panorama.addClass("ipnrm-fullscreen ipnrm-fullscreen-emulation"),this.controls.$panorama.get(0).offsetHeight,this.controls.$fullscreen.addClass("ipnrm-active")),this.refreshLayout();else if(this.controls.$fullscreen.hasClass("ipnrm-active"))try{document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}catch(t){}else try{var t=this.controls.$panorama.get(0);t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}catch(t){}},toggleAutoRotate:function(){this.config.autoRotate=this.autoRotate.enabled=!this.autoRotate.enabled,this.timeInteraction=Date.now()-this.config.autoRotateInactivityDelay,this.autoRotate.enabled?(this.controls.$autorotate.addClass("ipnrm-active"),this.animateStart()):this.controls.$autorotate.removeClass("ipnrm-active")},toggleGrab:function(){this.config.grab=!this.config.grab,this.config.grab?(this.controls.$view.on("mousedown.ipanorama",t.proxy(this.onGrabMouseDown,this)),this.controls.$view.on("touchstart.ipanorama",t.proxy(this.onGrabTouchStart,this)),this.controls.$view.on("touchmove.ipanorama",t.proxy(this.onGrabTouchMove,this)),this.controls.$view.on("touchend.ipanorama",t.proxy(this.onGrabTouchEnd,this))):(this.controls.$view.off("mousedown.ipanorama"),this.controls.$view.off("touchstart.ipanorama"),this.controls.$view.off("touchmove.ipanorama"),this.controls.$view.off("touchend.ipanorama"))},onFullScreen:function(){this.toggleFullScreen()},onAutoRotate:function(){this.toggleAutoRotate()},onShare:function(t){"function"==typeof this.config.onShare&&this.config.onShare.call(this,t)},onMouseClick:function(t){this.isLoading()||this.getHotSpotParameters(t)},onGrabMouseDown:function(o){o.preventDefault(),o.stopPropagation(),this.isLoading()||this.hotSpotSetupControl.enabled||(this.controls.$panorama.focus(),this.applyGrabControl(o),t(window).on("mousemove.ipanorama-"+this.id,t.proxy(this.onGrabMouseMove,this)),t(window).on("mouseup.ipanorama-"+this.id,t.proxy(this.onGrabMouseUp,this)))},onGrabMouseMove:function(t){this.updateGrabControl(t)},onGrabMouseUp:function(o){this.resetGrabControl(o),t(window).off("mousemove.ipanorama-"+this.id),t(window).off("mouseup.ipanorama-"+this.id)},onGrabTouchStart:function(t){this.isLoading()||this.applyGrabControl(t)},onGrabTouchMove:function(t){if(!this.isLoading()&&this.grabControl.enabled&&!this.pinchZoom.startDate){t.preventDefault();var o=this.getMousePosition(t.originalEvent.targetTouches[0]);this.yaw.valuePrev=this.yaw.value,this.pitch.valuePrev=this.pitch.value,this.yaw.value=(this.grabControl.x-o.x)*this.config.grabCoef+this.grabControl.yawSaved,this.pitch.value=(o.y-this.grabControl.y)*this.config.grabCoef+this.grabControl.pitchSaved,this.controlYawPitchLimits()}},onGrabTouchEnd:function(t){this.resetGrabControl(t)},onMultiTouchStart:function(o){this.isLoading()||(this.pinchZoom.aStart=o.originalEvent.touches[0]&&o.originalEvent.touches.length>1,this.pinchZoom.bStart=o.originalEvent.touches[1],!this.pinchZoom.aIsMoving&&!this.pinchZoom.bIsMoving&&this.pinchZoom.aStart&&this.pinchZoom.bStart&&(this.config.pinchZoomPreventDefault&&(o.preventDefault(),o.stopPropagation()),this.pinchZoom.aStartX=o.originalEvent.touches[0].pageX,this.pinchZoom.aStartY=o.originalEvent.touches[0].pageY,this.pinchZoom.bStartX=o.originalEvent.touches[1].pageX,this.pinchZoom.bStartY=o.originalEvent.touches[1].pageY,this.controls.$view.on("touchmove.ipanorama-pinchzoom",t.proxy(this.onMultiTouchMove,this)),this.pinchZoom.zoom=this.zoom.value,this.pinchZoom.startDate=(new Date).getTime(),this.pinchZoom.aCurX=this.pinchZoom.aStartX,this.pinchZoom.aCurY=this.pinchZoom.aStartY,this.pinchZoom.bCurX=this.pinchZoom.bStartX,this.pinchZoom.bCurY=this.pinchZoom.bStartY,this.pinchZoom.aIsMoving=!0,this.pinchZoom.bIsMoving=!0))},onMultiTouchMove:function(t){if(this.config.preventDefault&&(t.preventDefault(),t.stopPropagation()),this.pinchZoom.aIsMoving||this.pinchZoom.bIsMoving){this.pinchZoom.aCurX=t.originalEvent.touches[0].pageX,this.pinchZoom.aCurY=t.originalEvent.touches[0].pageY,this.pinchZoom.bCurX=t.originalEvent.touches[1].pageX,this.pinchZoom.bCurY=t.originalEvent.touches[1].pageY;var o=(new Date).getTime(),e=(this.pinchZoom.startDate,this.pinchZoom.aCurX),i=this.pinchZoom.aCurY,n=this.pinchZoom.bCurX,s=this.pinchZoom.bCurY,a=e-this.pinchZoom.aStartX,r=i-this.pinchZoom.aStartY,h=n-this.pinchZoom.bStartX,c=s-this.pinchZoom.bStartY,l=(Math.abs(a),Math.abs(r),Math.abs(h),Math.abs(c),Math.sqrt((this.pinchZoom.aStartX-this.pinchZoom.bStartX)*(this.pinchZoom.aStartX-this.pinchZoom.bStartX)+(this.pinchZoom.aStartY-this.pinchZoom.bStartY)*(this.pinchZoom.aStartY-this.pinchZoom.bStartY))-Math.sqrt((e-n)*(e-n)+(i-s)*(i-s)));this.zoom.value=Math.max(this.zoom.min,Math.min(this.zoom.max,this.pinchZoom.zoom+l*this.config.pinchZoomCoef))}},onMultiTouchEnd:function(t){this.config.pinchZoomPreventDefault&&(t.preventDefault(),t.stopPropagation()),this.controls.$view.off("touchmove.ipanorama-pinchzoom"),this.multiTouchReset()},multiTouchReset:function(){this.pinchZoom.aStartX=!1,this.pinchZoom.aStartY=!1,this.pinchZoom.bStartX=!1,this.pinchZoom.bStartY=!1,this.pinchZoom.startDate=!1,this.pinchZoom.aIsMoving=!1,this.pinchZoom.bIsMoving=!1},onHoverGrabEnter:function(o){this.isLoading()||this.hoverGrabControl.enabled||(this.hoverGrabControl.enabled=!0,this.controls.$panorama.on("mousemove.ipanorama",t.proxy(this.onHoverGrabMove,this)),this.resetTransition(),this.animateStart())},onHoverGrabLeave:function(t){this.hoverGrabControl.enabled&&(this.hoverGrabControl.enabled=!1,this.controls.$panorama.off("mousemove.ipanorama"))},onHoverGrabMove:function(t){if(!this.isLoading()){var o=this.getMousePositionPower(t);this.hoverGrabControl.power=o,this.hoverGrabControl.enabled&&!this.grabControl.enabled&&(this.yaw.valuePrev=this.yaw.value,this.pitch.valuePrev=this.pitch.value,this.yaw.value=this.hoverGrabControl.yawSaved+o.x*this.config.hoverGrabYawCoef,this.pitch.value=this.hoverGrabControl.pitchSaved+o.y*this.config.hoverGrabPitchCoef,this.controlYawPitchLimits())}},onPanoramaEnter:function(t){this.controls.$panorama.removeClass("ipnrm-hide-controls"),this.refreshLayout()},onPanoramaLeave:function(t){this.controls.$panorama.addClass("ipnrm-hide-controls"),this.refreshLayout()},onKeyDown:function(t){this.isLoading()||(this.autoRotate.enabled=!1,this.timeInteraction=Date.now(),!t.ctrlKey&&!t.metaKey||!this.config.hotSpotSetup||this.grabControl.enabled?38===t.keyCode&&!0===this.config.keyboardNav?this.setPitch(this.pitch.value+10):40===t.keyCode&&!0===this.config.keyboardNav?this.setPitch(this.pitch.value-10):37===t.keyCode&&!0===this.config.keyboardNav?this.setYaw(this.yaw.value-10):39===t.keyCode&&!0===this.config.keyboardNav?this.setYaw(this.yaw.value+10):189!==t.keyCode&&109!==t.keyCode||!0!==this.config.keyboardZoom?187!==t.keyCode&&107!==t.keyCode||!0!==this.config.keyboardZoom||this.setZoom(this.zoom.value-10):this.setZoom(this.zoom.value+10):this.applyHotSpotSetupControl())},onKeyUp:function(t){this.config.hotSpotSetup&&this.resetHotSpotSetupControl(),this.config.autoRotate&&(this.autoRotate.enabled=!0,this.timeInteraction=Date.now(),this.animateStart())},resize:function(){if(!this.isLoading()){var o=this.controls.$view.width(),e=this.controls.$view.height();if(0==o&&0==e){var i=t(this.config.containerSizeSelector);o=i.width(),e=i.height()}this.aspect=o/e,this.camera.aspect=this.aspect,this.camera.updateProjectionMatrix(),this.renderer.setSize(o,e),this.animateStart()}},refreshLayout:function(){this.resize(),this.onFullScreenChange()},onResize:function(t){this.refreshLayout()},onBlur:function(t){this.resetHotSpotSetupControl(),this.timePrev=void 0},onLoadBtnClick:function(t){this.controls.$loadBtn.hide(),this.loadScene(this.config.sceneId)},onSceneThumbClick:function(o){var e=t(o.currentTarget).attr("data-sceneid");this.loadScene(e)},onSceneThumbsGrabMouseDown:function(o){o.preventDefault(),o.stopPropagation(),this.applySceneThumbsGrabControl(o),t(window).on("mousemove.ipanorama-"+this.id+"-thumbs",t.proxy(this.onSceneThumbsGrabMouseMove,this)),t(window).on("mouseup.ipanorama-"+this.id+"-thumbs",t.proxy(this.onSceneThumbsGrabMouseUp,this))},onSceneThumbsGrabMouseMove:function(t){this.updateSceneThumbsGrabControl(t)},onSceneThumbsGrabMouseUp:function(o){this.resetSceneThumbsGrabControl(o),t(window).off("mousemove.ipanorama-"+this.id+"-thumbs"),t(window).off("mouseup.ipanorama-"+this.id+"-thumbs")},onSceneThumbsGrabTouchStart:function(t){this.applySceneThumbsGrabControl(t)},onSceneThumbsGrabTouchMove:function(t){t.preventDefault(),this.updateSceneThumbsGrabControl(t)},onSceneThumbsGrabTouchEnd:function(t){this.resetSceneThumbsGrabControl(t)},onSceneThumbsWheel:function(t){t.preventDefault();var o=1;(t=t.originalEvent).wheelDeltaY?o=t.wheelDeltaY>0?-1:1:t.wheelDelta?o=t.wheelDelta>0?-1:1:t.detail&&(o=t.detail>0?1:-1);var e=this.sceneThumbIndex+o;e<0||this.sceneIdThumbsArray.length<=1?e=0:e>=this.sceneIdThumbsArray.length-1&&(e=this.sceneIdThumbsArray.length-1),this.sceneThumbIndex=e,this.moveToSceneThumb(e)},moveToSceneThumb:function(t){var o=this.sceneIdThumbsArray[t],e=this.controls.$sceneThumbsInner.find(".ipnrm-scene-thumb[data-sceneid='"+o+"']"),i=this.getOffsetRect(this.controls.$sceneThumbsInner),n=e.length?this.getOffsetRect(e):0,s=e.length?this.getMargins(e):0,a=i.top-(n.top-s.top),r=i.left-(n.left-s.left);this.sceneThumbsControl.topSaved=a,this.sceneThumbsControl.leftSaved=r,this.updateSceneThumbs(a,r)},updateSceneThumbs:function(t,o){this.config.sceneThumbsVertical?this.controls.$sceneThumbsInner.css({transform:"translate3d(0px, "+t+"px, 0px)","-webkit-transform":"translate3d(0px, "+t+"px, 0px)"}):this.controls.$sceneThumbsInner.css({transform:"translate3d("+o+"px, 0px, 0px)","-webkit-transform":"translate3d("+o+"px, 0px, 0px)"})},onSceneMenuClick:function(t){this.controls.$sceneThumbs.toggleClass("ipnrm-active"),this.controls.$sceneThumbs.hasClass("ipnrm-active")?(this.controls.$sceneMenu.addClass("ipnrm-active"),this.controls.$panorama.addClass("ipnrm-scene-thumbs-active")):(this.controls.$sceneMenu.removeClass("ipnrm-active"),this.controls.$panorama.removeClass("ipnrm-scene-thumbs-active"),this.config.showSceneThumbsCtrl=!1),this.refreshSceneThumb(this.sceneId),this.refreshLayout()},onScenePrevClick:function(t){var o=this.getPrevSceneId(this.sceneId);o?this.loadScene(o):this.config.sceneNextPrevLoop&&this.loadScene(this.getLastSceneId())},onSceneNextClick:function(t){var o=this.getNextSceneId(this.sceneId);o?this.loadScene(o):this.config.sceneNextPrevLoop&&this.loadScene(this.getFirstSceneId())},onZoomIn:function(t){this.isLoading()||this.setZoom(this.zoom.value-10)},onZoomOut:function(t){this.isLoading()||this.setZoom(this.zoom.value+10)},onMouseWheel:function(t){if(this.config.mouseWheelPreventDefault&&(t.preventDefault(),t.stopPropagation()),!this.isLoading()){(t=t.originalEvent).wheelDeltaY?this.config.mouseWheelRotate?this.setYaw(this.yaw.value-t.wheelDeltaY*this.config.mouseWheelRotateCoef):this.config.mouseWheelZoom&&this.setZoom(this.zoom.value-t.wheelDeltaY*this.config.mouseWheelZoomCoef):t.wheelDelta?this.config.mouseWheelRotate?this.setYaw(this.yaw.value-t.wheelDelta*this.config.mouseWheelRotateCoef):this.config.mouseWheelZoom&&this.setZoom(this.zoom.value-t.wheelDelta*this.config.mouseWheelZoomCoef):t.detail&&(this.config.mouseWheelRotate?this.setYaw(this.yaw.value+t.detail*this.config.mouseWheelRotateCoef*100):this.config.mouseWheelZoom&&this.setZoom(this.zoom.value+t.detail*this.config.mouseWheelZoomCoef*100))}},setYaw:function(t,o){this.yaw.valuePrev=this.yaw.value,this.yaw.valueNext=t,this.yaw.time=0,this.yaw.duration=o||1e3,this.animateStart()},setPitch:function(t,o){this.pitch.valuePrev=this.pitch.value,this.pitch.valueNext=t,this.pitch.time=0,this.pitch.duration=o||1e3,this.animateStart()},setZoom:function(t,o){this.zoom.valuePrev=this.zoom.value,this.zoom.valueNext=t,this.zoom.time=0,this.zoom.duration=o||500,this.animateStart()},applySceneThumbsGrabControl:function(t){var o={x:0,y:0};window.TouchEvent&&t.originalEvent instanceof TouchEvent?o=this.getMousePosition(t.originalEvent.targetTouches[0]):(o.x=t.clientX,o.y=t.clientY),this.sceneThumbsControl.grab=!0,this.sceneThumbsControl.x=o.x,this.sceneThumbsControl.y=o.y,this.sceneThumbsControl.top=this.sceneThumbsControl.topSaved,this.sceneThumbsControl.left=this.sceneThumbsControl.leftSaved,this.controls.$sceneThumbsInner.addClass("ipnrm-notransition")},updateSceneThumbsGrabControl:function(t){if(this.sceneThumbsControl.grab){var o={x:0,y:0};window.TouchEvent&&t.originalEvent instanceof TouchEvent?o=this.getMousePosition(t.originalEvent.targetTouches[0]):(o.x=t.clientX,o.y=t.clientY),this.sceneThumbsControl.top=this.sceneThumbsControl.topSaved+o.y-this.sceneThumbsControl.y,this.sceneThumbsControl.left=this.sceneThumbsControl.leftSaved+o.x-this.sceneThumbsControl.x,this.updateSceneThumbs(this.sceneThumbsControl.top,this.sceneThumbsControl.left)}},resetSceneThumbsGrabControl:function(o){if(this.sceneThumbsControl.grab){this.sceneThumbsControl.grab=!1,this.sceneThumbsControl.topSaved=this.sceneThumbsControl.top,this.sceneThumbsControl.leftSaved=this.sceneThumbsControl.left;var e=this,i=0;this.controls.$sceneThumbsInner.find(".ipnrm-scene-thumb").each(function(o){var n=t(this),s=e.getOffsetRect(e.controls.$sceneThumbs),a=e.getOffsetRect(n),r=0;if(r=e.config.sceneThumbsVertical?a.top+a.height/2-s.top:a.left+a.width/2-s.left,i=o,r>0)return!1}),this.controls.$sceneThumbsInner[0].offsetHeight,this.controls.$sceneThumbsInner.removeClass("ipnrm-notransition"),this.sceneThumbIndex=i,this.moveToSceneThumb(i)}},applyGrabControl:function(t){this.setViewCursorShape("ipnrm-grabbing"),this.autoRotate.enabled=!1,this.timeInteraction=Date.now();var o={x:0,y:0};window.TouchEvent&&t.originalEvent instanceof TouchEvent?o=this.getMousePosition(t.originalEvent.targetTouches[0]):(o.x=t.clientX,o.y=t.clientY),this.grabControl.enabled=!0,this.grabControl.x=o.x,this.grabControl.y=o.y,this.grabControl.yawSaved=this.yaw.value,this.grabControl.pitchSaved=this.pitch.value,this.resetTransition(),this.animateStart()},updateGrabControl:function(t){if(this.grabControl.enabled){this.timeInteraction=Date.now();var o={x:0,y:0};window.TouchEvent&&t.originalEvent instanceof TouchEvent?o=this.getMousePosition(t.originalEvent.targetTouches[0]):(o.x=t.clientX,o.y=t.clientY),this.yaw.valuePrev=this.yaw.value,this.pitch.valuePrev=this.pitch.value,this.yaw.value=(this.grabControl.x-o.x)*this.config.grabCoef+this.grabControl.yawSaved,this.pitch.value=(o.y-this.grabControl.y)*this.config.grabCoef+this.grabControl.pitchSaved,this.controlYawPitchLimits()}},resetGrabControl:function(t){if(this.grabControl.enabled){this.config.autoRotate&&(this.autoRotate.enabled=!0),this.grabControl.enabled=!1,this.setViewCursorShape("ipnrm-grab"),this.controlHoverGrabControl();var o=this.yaw.value-this.grabControl.yawSaved,e=this.pitch.value-this.grabControl.pitchSaved;this.setYaw(this.yaw.value+1*Math.sign(o),500),this.setPitch(this.pitch.value+1*Math.sign(e),500)}},controlHoverGrabControl:function(){if(this.config.hoverGrab&&this.hoverGrabControl.power){var t=this.hoverGrabControl.power,o=this.yaw.value-t.x*this.config.hoverGrabYawCoef,e=this.pitch.value-t.y*this.config.hoverGrabPitchCoef,i=this.config.scenes[this.sceneId];if(i.yawLimits){var n=this.yaw.valueInit-o;n<0&&Math.abs(n)>i.yawLimitLeft?o=this.yaw.valueInit+i.yawLimitLeft:n>0&&Math.abs(n)>i.yawLimitRight&&(o=this.yaw.valueInit-i.yawLimitRight)}if(i.pitchLimits){var s=this.pitch.valueInit-e;s>0&&Math.abs(s)>i.pitchLimitUp?e=this.pitch.valueInit-i.pitchLimitUp:s<0&&Math.abs(s)>i.pitchLimitDown&&(e=this.pitch.valueInit+i.pitchLimitDown)}this.hoverGrabControl.yawSaved=o,this.hoverGrabControl.pitchSaved=e}},applyHotSpotSetupControl:function(){this.hotSpotSetupControl.enabled||(this.setViewCursorShape("ipnrm-target"),this.hotSpotSetupControl.enabled=!0)},getHotSpotParameters:function(t){if(this.hotSpotSetupControl.enabled||"function"==typeof this.config.onHotSpotSetup){var o=this.getHotSpotYawPitch(t);this.hotSpotSetupControl.enabled&&console.log("yaw: "+o.yaw+", pitch: "+o.pitch+", camera yaw: "+this.yaw.value+", camera pitch: "+this.pitch.value+", camera zoom: "+this.zoom.value),"function"==typeof this.config.onHotSpotSetup&&this.config.onHotSpotSetup.call(this,o.yaw,o.pitch,this.yaw.value,this.pitch.value,this.zoom.value,t)}},getHotSpotYawPitch:function(t){var o=this.controls.$view.offset(),e=t.pageX-o.left,i=t.pageY-o.top,n=this.controls.$view.get(0).getBoundingClientRect(),s=e/(n.right-n.left)*2-1,a=1-i/(n.bottom-n.top)*2,r=new THREE.Vector3(s,a,.5);r.unproject(this.camera);var h=r.sub(this.camera.position).normalize(),c=Math.atan(h.x/h.z),l=Math.atan(h.y/Math.sqrt(h.z*h.z+h.x*h.x));return c=-THREE.Math.radToDeg(c),l=THREE.Math.radToDeg(l),h.z<=0?c=180+c:h.x>0&&(c=360+c),{yaw:c,pitch:l}},resetHotSpotSetupControl:function(){this.setViewCursorShape("ipnrm-grab"),this.hotSpotSetupControl.enabled=!1},setViewCursorShape:function(t){this.controls.$view.removeClass("ipnrm-grab"),this.controls.$view.removeClass("ipnrm-grabbing"),this.controls.$view.removeClass("ipnrm-target"),(this.config.grab||"ipnrm-target"==t)&&this.controls.$view.addClass(t)},lookAt:function(t,o){this.setYaw(t,500),this.setPitch(o,500)},isLoading:function(){return this.loading||!this.scene},getFirstSceneId:function(){var t=null;for(var o in this.config.scenes)if(this.config.scenes.hasOwnProperty(o)){t=o;break}return t},getLastSceneId:function(){var t=null;for(var o in this.config.scenes)this.config.scenes.hasOwnProperty(o)&&(t=o);return t},getPrevSceneId:function(t){var o=!1,e=null;for(var i in this.config.scenes)if(this.config.scenes.hasOwnProperty(i)){if(i==t&&(o=!0),o)break;e=i}return e},getNextSceneId:function(t){var o=!1,e=null;for(var i in this.config.scenes)if(this.config.scenes.hasOwnProperty(i)){if(o){e=i;break}i==t&&(o=!0)}return e},getOffsetRect:function(t){var o=t.get(0).getBoundingClientRect(),e=document.body,i=document.documentElement,n=window.pageYOffset||i.scrollTop||e.scrollTop,s=window.pageXOffset||i.scrollLeft||e.scrollLeft,a=i.clientTop||e.clientTop||0,r=i.clientLeft||e.clientLeft||0,h=o.top+n-a,c=o.left+s-r;return{top:Math.round(h),left:Math.round(c),width:o.width,height:o.height}},getMargins:function(t){var o=parseInt(t.css("margin-top"),10),e=parseInt(t.css("margin-bottom"),10),i=parseInt(t.css("margin-left"),10),n=parseInt(t.css("margin-right"),10);return isNaN(o)&&(o=0),isNaN(e)&&(e=0),isNaN(i)&&(i=0),isNaN(n)&&(n=0),{top:o,left:i,bottom:e,right:n}},getPitchYawPoint:function(t,o){var e=new THREE.Vector3(0,0,0);return e.x=Math.sin(THREE.Math.degToRad(180-o))*Math.cos(THREE.Math.degToRad(180-t)),e.y=Math.sin(THREE.Math.degToRad(180-t)),e.z=Math.cos(THREE.Math.degToRad(180-o))*Math.cos(THREE.Math.degToRad(180-t)),e},getMousePositionPower:function(t){var o=this.controls.$panorama.get(0).getBoundingClientRect(),e={},i=(o.right-o.left)/2,n=(o.bottom-o.top)/2,s=document.body,a=document.documentElement,r=window.pageYOffset||a.scrollTop||s.scrollTop,h=window.pageXOffset||a.scrollLeft||s.scrollLeft,c=a.clientTop||s.clientTop||0,l=a.clientLeft||s.clientLeft||0,p=o.top+r-c,m=o.left+h-l;p=Math.round(p),m=Math.round(m),p=t.pageY-p,m=t.pageX-m;return e.x=(m-i)/i,e.y=(n-p)/n,e.x=e.x<-1?-1:e.x>1?1:e.x,e.y=e.y<-1?-1:e.y>1?1:e.y,e},applyInterpolation:function(t,o){if(t.time<t.duration){t.time+=o;var e=t.time/t.duration;t.value=t.valuePrev+(t.valueNext-t.valuePrev)*e}},createTexture:function(t,o){var e=new THREE.Texture;return e.image=t[o],e.needsUpdate=!0,e},getMousePosition:function(t){var o=this.controls.$panorama.get(0).getBoundingClientRect(),e={};return e.x=t.clientX-o.left,e.y=t.clientY-o.top,e},showLoadInfo:function(){this.controls.$loadProgressBar.css({width:0}),this.controls.$loadInfo.css({display:""}).fadeTo("slow",1),this.controls.$loadInfo.get(0).offsetHeight},hideLoadInfo:function(){this.controls.$loadInfo.fadeTo("slow",0,function(){t(this).css({display:"none"})})},applyScenePrevNextCtrls:function(t){if(!this.config.sceneNextPrevLoop){var o=this.getPrevSceneId(t),e=this.getNextSceneId(t);o?this.controls.$scenePrev.removeClass("ipnrm-disable"):this.controls.$scenePrev.addClass("ipnrm-disable"),e?this.controls.$sceneNext.removeClass("ipnrm-disable"):this.controls.$sceneNext.addClass("ipnrm-disable")}},applySceneThumbs:function(t){this.config.sceneThumbsVertical?this.controls.$panorama.addClass("ipnrm-scene-thumbs-v").removeClass("ipnrm-scene-thumbs-h"):this.controls.$panorama.addClass("ipnrm-scene-thumbs-h").removeClass("ipnrm-scene-thumbs-v"),this.config.showSceneThumbsCtrl&&(this.controls.$sceneThumbs.addClass("ipnrm-active"),this.controls.$panorama.addClass("ipnrm-scene-thumbs-active")),this.refreshSceneThumb(t)},refreshSceneThumb:function(t){if(this.controls.$sceneThumbs.hasClass("ipnrm-active")&&(this.controls.$sceneThumbs.find(".ipnrm-scene-thumb.ipnrm-active").removeClass("ipnrm-active"),this.controls.$sceneThumbs.find(".ipnrm-scene-thumb[data-sceneid='"+t+"']").addClass("ipnrm-active"),!this.config.sceneThumbsStatic)){var o=this.sceneIdThumbsArray.indexOf(t);o>=0&&this.moveToSceneThumb(o)}},applyControls:function(t){this.controls.$toolbar.fadeIn("slow"),this.config.showSceneMenuCtrl?(this.controls.$sceneMenu.fadeIn("slow"),this.controls.$panorama.removeClass("ipnrm-no-scene-menu-ctrl")):this.controls.$panorama.addClass("ipnrm-no-scene-menu-ctrl"),this.config.showSceneNextPrevCtrl?(this.controls.$sceneNext.fadeIn("slow"),this.controls.$scenePrev.fadeIn("slow"),this.controls.$panorama.removeClass("ipnrm-no-scene-nextprev-ctrl")):this.controls.$panorama.addClass("ipnrm-no-scene-nextprev-ctrl"),this.config.showZoomCtrl?(this.controls.$zoomIn.fadeIn("slow"),this.controls.$zoomOut.fadeIn("slow"),this.controls.$panorama.removeClass("ipnrm-no-zoom-ctrl")):this.controls.$panorama.addClass("ipnrm-no-zoom-ctrl"),this.config.showShareCtrl?(this.controls.$share.fadeIn("slow"),this.controls.$panorama.removeClass("ipnrm-no-share-ctrl")):this.controls.$panorama.addClass("ipnrm-no-share-ctrl"),this.config.showFullscreenCtrl?(this.controls.$fullscreen.fadeIn("slow"),this.controls.$panorama.removeClass("ipnrm-no-fullscreen-ctrl")):this.controls.$panorama.addClass("ipnrm-no-fullscreen-ctrl"),this.config.showAutoRotateCtrl?(this.controls.$autorotate.fadeIn("slow"),this.controls.$panorama.removeClass("ipnrm-no-autorotate-ctrl")):this.controls.$panorama.addClass("ipnrm-no-autorotate-ctrl"),this.config.compass&&null!=this.config.scenes[t].compassNorthOffset?(this.controls.$compass.fadeIn("slow"),this.controls.$panorama.removeClass("ipnrm-no-compass-ctrl")):(this.controls.$compass.fadeOut("slow"),this.controls.$panorama.addClass("ipnrm-no-compass-ctrl")),this.applyScenePrevNextCtrls(t),this.applySceneThumbs(t),this.applyTitle(t)},applyTitle:function(o){if(this.config.title){var e=this.config.scenes[o];if(e.title){var i="function"==typeof e.title?e.title.call(o):e.title;this.controls.$title.empty()[e.titleHtml?"string"==typeof i?"html":"append":"text"](i),this.controls.$title.fadeIn("slow")}else if(e.titleSelector){var n=t(e.titleSelector);this.controls.$title.empty()[e.titleHtml?"html":"text"](n.html()),this.controls.$title.fadeIn("slow")}else this.controls.$title.fadeOut("slow")}},showMessage:function(o){this.controls.$info.html(o),this.controls.$info.fadeIn(),setTimeout(t.proxy(function(){this.controls.$info.fadeOut()},this),5e3)},destroy:function(){this.resetHotSpots(),this.resetHandlers(),this.resetScene()},util:function(){return null!=this._util?this._util:this._util=new e}},t.fn.ipanorama=function(e,i){return this.each(function(){var n=t(this),s=n.data("ipanorama"),a=t.isPlainObject(e)?e:{};if("destroy"==e)return s?(n.removeData("ipanorama"),void s.destroy()):void console.error("Calling 'destroy' method on not initialized instance is forbidden");if("loadscene"==e)return s?i&&i.hasOwnProperty("sceneId")?void s.loadScene(i.sceneId):void console.error("Calling 'loadscene' method without the 'sceneId' parameter is forbidden"):void console.error("Calling 'loadscene' method on not initialized instance is forbidden");if("loadhotspots"==e)return s?i&&i.hasOwnProperty("sceneId")&&i.hasOwnProperty("hotSpots")?void s.loadHotSpots(i.sceneId,i.hotSpots):void console.error("Calling 'loadhotspots' method without the 'sceneId' and 'hotSpots' parameter is forbidden"):void console.error("Calling 'loadhotspots' method on not initialized instance is forbidden");if("lookat"==e)return s?i&&i.hasOwnProperty("yaw")&&i.hasOwnProperty("pitch")?void s.lookAt(i.yaw,i.pitch):void console.error("Calling 'lookat' method without the 'yaw' and 'pitch' parameter is forbidden"):void console.error("Calling 'lookat' method on not initialized instance is forbidden");if("resize"==e)return s?void s.resize():void console.error("Calling 'resize' method on not initialized instance is forbidden");if("fullscreen"==e)return s?void s.toggleFullScreen():void console.error("Calling 'fullscreen' method on not initialized instance is forbidden");if("grab"==e)return s?void s.toggleGrab():void console.error("Calling 'grab' method on not initialized instance is forbidden");if("instance"==e)return s||void console.error("Calling 'instance' method on not initialized instance is forbidden");if(s){var r=t.extend({},s.config,a);s.init(n,r)}else{s=new o(n,r=t.extend({},o.prototype.defaults,a)),n.data("ipanorama",s)}})}}(window.jQuery);